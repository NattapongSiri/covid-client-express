(this["webpackJsonpcovid-client"]=this["webpackJsonpcovid-client"]||[]).push([[0],{60:function(e,t,a){e.exports=a.p+"static/media/watson-avatar.d9c2b1bd.png"},63:function(e,t,a){e.exports=a.p+"static/media/watsondark.942da270.gif"},64:function(e,t,a){e.exports=a.p+"static/media/watsonlight.7ef19e7f.gif"},75:function(e,t,a){e.exports=a(99)},90:function(e,t,a){},91:function(e,t,a){},99:function(e,t,a){"use strict";a.r(t);var n,r=a(0),o=a.n(r),i=a(24),s=a.n(i),c=a(66),l=a(44),u=(a(90),a(11)),d=(a(91),a(18)),m=a.n(d),p=a(45),g=a(27),h=a(35),f=a.n(h),b=a(126),v=a(130),y=a(69),E=a(133);!function(e){e[e.sending=0]="sending",e[e.failed=1]="failed",e[e.succeed=2]="succeed"}(n||(n={}));var x=a(59),w=a.n(x),k=a(135),O=a(136),j=a(120),S=a(121),C=a(122),_=a(36),I=a(123),T=a(124),P=a(125),R=a(119),A=a(60),N=a.n(A),D=navigator.language?navigator.language:"en_US",W=o.a.createContext({locale:D,light:!1,toggleLight:function(){},setLocale:function(e){}}),F=Object(v.a)((function(e){return{self:{maxWidth:"75vw",width:"max-content",height:"max-content",display:"inline-block",color:e.palette.text.primary,backgroundColor:e.palette.background.paper,borderRadius:"4px",boxShadow:"2px 8px 5px #000",position:"relative",margin:"0 12px 0 0",zIndex:10},other:{maxWidth:"75vw",width:"max-content",height:"max-content",display:"inline-block",color:e.palette.text.primary,backgroundColor:e.palette.background.paper,borderRadius:"4px",boxShadow:"2px 8px 5px #000",position:"relative",margin:"0 0 0 10px",zIndex:10}}})),L=Object(v.a)((function(e){return{self:{position:"absolute",width:0,height:0,right:"-2px",bottom:"40px",left:"auto",zIndex:-1,"&:after":{content:'""',position:"absolute",border:"0 solid transparent",borderTop:"9px solid ".concat(e.palette.background.paper),borderRadius:"0 20px 0",width:"15px",height:"30px",transform:"rotate(45deg) scaleY(-1)"}},other:{position:"absolute",width:0,bottom:"42px",left:"-16px",height:0,zIndex:-1,"&:after":{content:'""',position:"absolute",border:"0 solid transparent",borderTop:"9px solid ".concat(e.palette.background.paper),borderRadius:"0 20px 0",width:"15px",height:"30px",transform:"rotate(145deg)"}}}})),U=Object(v.a)({self:{fontWeight:600,fontSize:"0.7rem",color:"#66ff99",textAlign:"right"},other:{fontWeight:600,fontSize:"0.7rem",color:"#66ccff",textAlign:"left"}}),K=Object(v.a)((function(e){return{self:{backgroundColor:e.palette.background.default,display:"flex",flexWrap:"wrap",alignItems:"flex-end",justifyContent:"flex-end",margin:"1vw 0",position:"relative"},other:{backgroundColor:e.palette.background.default,display:"flex",flexWrap:"wrap",alignItems:"flex-end",justifyContent:"flex-start",margin:"1vw 0",position:"relative"}}})),B=Object(v.a)({root:{flexBasis:"100%"}});function M(e){var t=e.message,a=e.onChoose;return function(){var e="self"===t.type,i=Object(y.a)(),s=F(i),c=L(i),l=U(),u=K(i),d=B(),m=Object(v.a)({root:{padding:"1vh 2vw"}})(),p=Object(r.useContext)(W),g=new Intl.DateTimeFormat(p.locale,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"});return o.a.createElement(R.a,{theme:i},o.a.createElement("div",{className:e?u.self:u.other},!e&&o.a.createElement(k.a,{style:{display:"inline-block"},src:N.a}),o.a.createElement("div",{className:e?s.self:s.other},o.a.createElement(O.a,{elevation:0},o.a.createElement(j.a,{classes:{root:m.root,subheader:e?l.self:l.other},subheader:e?"You":"Watson",titleTypographyProps:{variant:"body2"}}),o.a.createElement(S.a,null),o.a.createElement(C.a,{style:{padding:"8px 55px 8px 14px",margin:0}},o.a.createElement(_.a,{style:{overflow:"auto"}},o.a.createElement("span",{style:{textAlign:"left"},dangerouslySetInnerHTML:{__html:t.message}}))),t.suggestions&&o.a.createElement(o.a.Fragment,null,o.a.createElement(S.a,null),o.a.createElement(C.a,null,t.suggestions.map((function(e){return o.a.createElement(I.a,{key:e.uuid,style:{margin:"2vmin"},variant:"outlined",onClick:function(){a&&a(e.label)}},e.label)})))),t.reference&&o.a.createElement(o.a.Fragment,null,o.a.createElement(S.a,null),o.a.createElement(T.a,null,o.a.createElement(I.a,{variant:"outlined",onClick:function(){window.open(t.reference)}},"Click to view original page"))),t.previewUrl&&o.a.createElement(o.a.Fragment,null,o.a.createElement(S.a,null),o.a.createElement(P.a,null,o.a.createElement("iframe",{title:t.message,style:{width:"75vw",height:"75vh"},src:t.previewUrl.toString()})))),o.a.createElement("div",{className:e?c.self:c.other})),e&&o.a.createElement(k.a,{style:{display:"inline-block"}}),o.a.createElement("div",{className:d.root}),t.state===n.succeed&&o.a.createElement(_.a,{color:"textSecondary",variant:"body2",display:"block",style:{margin:e?"3px 55px 1vh 0":"3px 0 1vh 55px"}},g.format(t.timestamp)),t.state===n.sending&&o.a.createElement(_.a,{variant:"body2",display:"block",style:{margin:e?"3px 55px 1vh 0":"3px 0 1vh 55px",color:"dark"===i.palette.type?i.palette.warning.dark:i.palette.warning.light}},"Sending"),t.state===n.failed&&o.a.createElement(_.a,{variant:"body2",display:"block",style:{margin:e?"3px 55px 1vh 0":"3px 0 1vh 55px",color:"dark"===i.palette.type?i.palette.error.dark:i.palette.error.light}},"Failed")))}()}function z(e){var t=e.messages,a=e.style,i=e.onChoose,s=Object(r.useRef)(null),c=function(){s&&s.current?s.current.scrollIntoView({block:"end",behavior:"smooth"}):console.error("Bottom anchor reference is missing")};return Object(r.useEffect)((function(){var e=w()(c,80);return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}})),Object(r.useEffect)((function(){return c()})),o.a.createElement(b.a,{style:a},t.map((function(e){if(e.results)return o.a.createElement(o.a.Fragment,{key:e.uuid.substring(1)},o.a.createElement(M,{key:e.uuid,message:e,onChoose:i}),e.results.map((function(e){return o.a.createElement(M,{key:e.uuid,message:{uuid:e.uuid,message:e.highlight,type:"Watson",timestamp:new Date,reference:e.url,state:n.succeed}})})));if(e.message.startsWith("<a ")){var t=e.message.toLowerCase().indexOf('href="')+6,a=e.message.indexOf('"',t+1);if(t<a){var r=new URL(e.message.substring(t,a));e.previewUrl=r}return o.a.createElement(M,{key:e.uuid,message:e,onChoose:i})}if(e.message.startsWith("http")){var s=new URL(e.message);return e.message=s.hostname,e.previewUrl=s,o.a.createElement(M,{key:e.uuid,message:e,onChoose:i})}return o.a.createElement(M,{key:e.uuid,message:e,onChoose:i})})),o.a.createElement("div",{style:{width:0,height:0,display:"block"},ref:s}))}var H,Y,$=a(62),V=a(137),G=a(128),J=a(129),X=a(127),q=Object(v.a)((function(e){return{root:{alignItem:"center",borderRadius:"50%",border:"1px solid grey",color:e.palette.text.primary,cursor:"pointer",margin:"0 2vw",padding:"1vw"}}})),Q=Object(v.a)((function(e){return{root:{display:"inline-block",position:"relative",width:"10vw",height:"10vw","& div":{position:"absolute",top:"45%",width:"15%",height:"15%",borderRadius:"50%",background:e.palette.text.primary,animationTimingFunction:"cubic-bezier(0, 1, 1, 0)","&:nth-child(1)":{left:"10%",animation:"$ldsEllipsis1 0.6s infinite"},"&:nth-child(2)":{left:"10%",animation:"$ldsEllipsis2 0.6s infinite"},"&:nth-child(3)":{left:"40%",animation:"$ldsEllipsis2 0.6s infinite"},"&:nth-child(4)":{left:"70%",animation:"$ldsEllipsis3 0.6s infinite"}}},"@keyframes ldsEllipsis1":{"0%":{transform:"scale(0)"},"100%":{transform:"scale(1)"}},"@keyframes ldsEllipsis3":{"0%":{transform:"scale(1)"},"100%":{transform:"scale(0)"}},"@keyframes ldsEllipsis2":{"0%":{transform:"translate(0, 0)"},"100%":{transform:"translate(3vw, 0)"}}}}));function Z(e){var t=e.onClick,a=Object(y.a)(),n=Q(a);return o.a.createElement("div",{onClick:t,className:n.root},o.a.createElement("div",null),o.a.createElement("div",null),o.a.createElement("div",null),o.a.createElement("div",null))}function ee(e){var t=e.onClick,a=e.onData,n=e.onStateChange;return function(){var e=Object(r.useState)(H.undefined),i=Object(u.a)(e,2),s=i[0],c=i[1],l=Object(r.useContext)(W);Object(r.useEffect)((function(){return navigator.mediaDevices.getUserMedia({audio:!0}).then((function(){if(console.log("Mic is available"),void 0===window.SpeechRecognition){var e=window.webkitSpeechRecognition;window.SpeechRecognition=e}var t=window.SpeechRecognition;t?(Y=new t).interimResults=!0:console.log("SpeechRecognition is not supported"),c(H.ready)})).catch((function(e){console.error(e)})),function(){Y&&Y.abort()}}),[]),Y&&(Y.lang=l.locale);var d=Object(y.a)(),m=q(d),p=function(e){var r=s;switch(s){case H.undefined:console.log("SpeechRecognition is not available"),n&&n(H.ready,r);break;case H.ready:console.log("Start recognition"),Y.start(),Y.onspeechend=function(){console.log("End of speech detected"),c(H.ready),n&&n(H.ready,H.start)},a&&(Y.onresult=function(e){a(e.results[0][0].transcript)}),c(H.start),n&&n(H.start,r);break;case H.start:console.log("Aborting recognition"),Y.abort();break;default:console.error("Unknown SpeechRecognition state")}t&&t(e,r)};return o.a.createElement(o.a.Fragment,null,s===H.ready&&o.a.createElement(X.a,{onClick:p,className:m.root,fontSize:"large"}),s===H.start&&o.a.createElement(Z,{onClick:p}))}()}!function(e){e[e[void 0]=0]="undefined",e[e.start=1]="start",e[e.ready=2]="ready"}(H||(H={}));var te,ae=Object(v.a)({root:{alignContent:"stretch",alignItems:"center",display:"flex",width:"100vw",height:"20vh"}}),ne=Object(v.a)({root:{flexGrow:1}});function re(e){var t=e.style,a=e.locked,n=void 0!==a&&a,i=e.onSubmit,s=Object($.a)(),c=Object(l.b)("chatDialog").t,d=ae(),m=ne(),p=Object(r.useState)(""),g=Object(u.a)(p,2),h=g[0],f=g[1],v=Object(r.useState)(!1),y=Object(u.a)(v,2),E=y[0],x=y[1],w=Object(r.useState)(te.Keyboard),k=Object(u.a)(w,2),O=k[0],j=k[1],S=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,a=Object(r.useState)(e),n=Object(u.a)(a,2),o=n[0],i=n[1];return Object(r.useEffect)((function(){var a=setTimeout((function(){return i(e)}),t);return function(){return clearTimeout(a)}}),[e,t]),o}(h,100);return Object(r.useEffect)((function(){E&&S.trim().length>0&&i&&(i(S),x(!1),f(""))}),[S,E,i]),o.a.createElement(R.a,{theme:s},o.a.createElement(b.a,{className:d.root,style:t},o.a.createElement(V.a,{className:m.root,disabled:n,placeholder:c("inputHelper"),onChange:function(e){return f(e.target.value)},onKeyDown:function(e){"Enter"!==e.key&&13!==e.keyCode||x(!0)},value:h,endAdornment:O===te.Keyboard&&h.trim().length>0&&o.a.createElement(G.a,{position:"end",style:{cursor:"pointer"},onClick:function(){x(!0)}},o.a.createElement(J.a,null))}),o.a.createElement(ee,{onData:function(e){return f(e)},onStateChange:function(e,t){e===H.start?j(te.Voice):e===H.ready&&t===H.start&&(j(te.Keyboard),console.log("Auto submit user input"),x(!0))}})))}!function(e){e[e.Keyboard=0]="Keyboard",e[e.Voice=1]="Voice"}(te||(te={}));var oe=a(67),ie=a(132),se=a(100),ce=a(47),le=a.n(ce),ue=a(63),de=a.n(ue),me=a(64),pe=a.n(me),ge=Object(v.a)((function(e){return{root:{display:"block",height:"12vh","& > img":{height:"inherit",width:"auto",display:"inline",position:"absolute",top:"0",left:"50%",transform:"translateX(-50%)"}}}})),he=a(68),fe=a(138),be=a(139),ve=a(131),ye={Thai:"th-TH",US:"en-US"};function Ee(e){var t=e.style,a=Object($.a)(),n=Object(r.useContext)(W);return o.a.createElement(R.a,{theme:a},o.a.createElement(fe.a,{style:Object(he.a)({},t,{width:"10vw"})},o.a.createElement(be.a,{id:"langid",style:{color:a.palette.text.primary}},"Language"),o.a.createElement(ve.a,{inputProps:{name:"langid",id:"langid"},value:n.locale,onChange:function(e){n.setLocale(e.target.value)}},Object.keys(ye).map((function(e){return o.a.createElement("option",{key:e,value:ye[e]},e)})))))}var xe=Object(v.a)({root:{borderRadius:"10vmin",backgroundColor:"#444",color:"#CCC",position:"absolute",top:"4vh",right:"15vw"}}),we=Object(se.a)({root:{},switchBase:{"&$checked+ $track":{backgroundColor:"#888",opacity:1}},track:{backgroundColor:"#888",opacity:1},checked:{}})((function(e){var t=e.classes,a=Object(oe.a)(e,["classes"]);return o.a.createElement(ie.a,Object.assign({},a,{classes:{track:t.track,switchBase:t.switchBase,checked:t.checked}}))}));function ke(){var e=Object(y.a)(),t=ge(e),a=xe(),n=Object(r.useContext)(W);return o.a.createElement(b.a,{className:t.root},"dark"===e.palette.type&&o.a.createElement("img",{src:de.a,alt:"IBM Watson"}),"dark"!==e.palette.type&&o.a.createElement("img",{src:pe.a,alt:"IBM Watson"}),o.a.createElement(we,{className:a.root,checked:n.light,onChange:function(){n.toggleLight&&n.toggleLight()},checkedIcon:o.a.createElement(le.a,{style:{color:"#FFF"}}),icon:o.a.createElement(le.a,{style:{color:"#000"}})}),o.a.createElement(Ee,{style:{position:"absolute",top:"3vh",right:"2vw"}}))}we.displayName="LightSwitch";var Oe=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_APIKEY:"65c191a6-e57c-4b65-a531-e2edff3f79b9",REACT_APP_CREATE_SESSION_ENDPOINT:"https://e5a82385.us-south.apigw.appdomain.cloud/ibmth_covid/create_wa_session",REACT_APP_SEND_MSG_ENDPOINT:"https://e5a82385.us-south.apigw.appdomain.cloud/ibmth_covid/message_wlt_wa",REACT_APP_RETRY_SEND:"1"}),je=Oe.REACT_APP_APIKEY,Se=Oe.REACT_APP_CREATE_SESSION_ENDPOINT,Ce=Oe.REACT_APP_SEND_MSG_ENDPOINT;function _e(){return Ie.apply(this,arguments)}function Ie(){return(Ie=Object(g.a)(m.a.mark((function e(){var t,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Se||!je){e.next=10;break}return e.next=3,fetch(Se,{method:"POST",cache:"no-cache",headers:{"X-IBM-Client-Id":je}});case 3:return t=e.sent,e.next=6,t.json();case 6:return a=e.sent,e.abrupt("return",a);case 10:console.error("Undefined messaging endpoint or APIKEY is invalid");case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Te(e){return Pe.apply(this,arguments)}function Pe(){return(Pe=Object(g.a)(m.a.mark((function e(t){var a,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.targetLang="en",!Ce||!je){e.next=11;break}return e.next=4,fetch(Ce,{method:"POST",cache:"no-cache",headers:{"Content-Type":"application/json","X-IBM-Client-Id":je},body:JSON.stringify(t)});case 4:return a=e.sent,e.next=7,a.json();case 7:return n=e.sent,e.abrupt("return",n);case 11:console.error("Undefined messaging endpoint or APIKEY is invalid");case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Re=parseInt("1"),Ae=Object(v.a)((function(e){return{root:{backgroundColor:e.palette.background.default}}}));function Ne(){var e=Object(y.a)(),t=Ae(e),a=Object(r.useState)(),i=Object(u.a)(a,2),s=i[0],c=i[1],l=Object(r.useState)([]),d=Object(u.a)(l,2),h=d[0],v=d[1],x=Object(r.useContext)(W),w=function(){var e=Object(g.a)(m.a.mark((function e(t){var a,r,o,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a={uuid:"m".concat(Object(E.a)()),message:t,type:"self",timestamp:new Date,state:n.sending},h=h.concat(a),v(h),e.prev=3,r=0;case 5:if(!(r<=Re)){e.next=33;break}if(a.state=n.sending,o=void 0,!s){e.next=14;break}return e.next=11,Te({sessionId:s,message:t,sourceLang:x.locale.substring(0,2)});case 11:o=e.sent,e.next=17;break;case 14:return e.next=16,Te({message:t,sourceLang:x.locale.substring(0,2)});case 16:o=e.sent;case 17:if(200!==o.status){e.next=23;break}if("break"!==function(){var e;s!==o.sessionId&&(c(s),s=o.sessionId),a.state=n.succeed;var t=o.result.output,r=o.result.context,i=t.generic.map((function(e){switch(e.response_type){case"text":return{uuid:"m".concat(Object(E.a)()),message:f()(e.text),type:"Watson",timestamp:new Date,context:r,state:n.succeed};case"suggestion":return{uuid:"m".concat(Object(E.a)()),message:e.title,type:"Watson",timestamp:new Date,context:r,state:n.succeed,suggestions:e.suggestions.map((function(e){return{uuid:"su".concat(Object(E.a)()),label:e.label,intents:e.value.input.intents}}))};case"search":return{uuid:"m".concat(Object(E.a)()),message:e.header,type:"Watson",timestamp:new Date,context:r,state:n.succeed,results:e.results.map((function(e){var t=void 0;return e.result_metadata&&e.result_metadata.source&&e.result_metadata.source.link?t=e.result_metadata.source.link.url:e.url&&(t=e.url),{uuid:"se".concat(Object(E.a)()),title:f()(e.title),highlight:f()(e.highlight.body[0]),url:t?f()(t):void 0}}))};case"option":return{uuid:"m".concat(Object(E.a)()),message:e.title,type:"Watson",timestamp:new Date,context:r,state:n.succeed,suggestions:e.options.map((function(e){return{uuid:"op".concat(Object(E.a)()),label:e.label}}))};default:return{uuid:"m".concat(Object(E.a)()),message:"Unsupported type of response. Please contact admin.",type:"Watson",timestamp:new Date,state:n.succeed}}}));return h=(e=h).concat.apply(e,Object(p.a)(i)),v(h),"break"}()){e.next=21;break}return e.abrupt("break",33);case 21:e.next=30;break;case 23:return console.error("Fail to send message to WA server. Wait for 1 second to retry."),e.next=26,new Promise((function(e){return setTimeout(e,1e3)}));case 26:return e.next=28,_e();case 28:201===(i=e.sent).status&&(c(i.result.session_id),s=i.result.session_id);case 30:r++,e.next=5;break;case 33:a.state!==n.succeed&&(a.state=n.failed,v(Object(p.a)(h)),console.error("Max number of retry attempted without succeed")),e.next=41;break;case 36:e.prev=36,e.t0=e.catch(3),a.state=n.failed,v(Object(p.a)(h)),console.error(e.t0);case 41:case"end":return e.stop()}}),e,null,[[3,36]])})));return function(t){return e.apply(this,arguments)}}();return o.a.createElement(b.a,{className:t.root},o.a.createElement(ke,null),o.a.createElement(z,{style:{height:"70vh",overflow:"scroll",padding:"0 0 0 0",margin:"0 0 0 0"},messages:h,onChoose:w}),o.a.createElement(re,{style:{height:"18vh"},onSubmit:function(e){w(e)}}))}var De=a(65),We=Object(De.a)({palette:{background:{default:"#000"},text:{primary:"#FFF",secondary:"#FFF"},type:"dark"}}),Fe=Object(De.a)({palette:{background:{paper:"#FFE"},type:"light"}});var Le=function(){var e=localStorage.getItem("locale"),t=Object(r.useState)(e||D),a=Object(u.a)(t,2),n=a[0],i=a[1],s=Object(r.useState)("true"===localStorage.getItem("light")),c=Object(u.a)(s,2),l=c[0],d=c[1];return o.a.createElement("div",{className:"App"},o.a.createElement("header",{className:"App-header"},o.a.createElement(W.Provider,{value:{locale:n,light:l,toggleLight:function(){localStorage.setItem("light",(!l).toString()),d(!l)},setLocale:function(e){localStorage.setItem("locale",e),i(e)}}},o.a.createElement(R.a,{theme:l?Fe:We},o.a.createElement(Ne,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Ue=navigator.language?navigator.language:"en_US";c.a.use(l.a).init({resources:{en:{chatDialog:{inputHelper:"Type your message here"}},th:{chatDialog:{inputHelper:"\u0e1e\u0e34\u0e21\u0e1e\u0e4c\u0e02\u0e49\u0e2d\u0e04\u0e27\u0e32\u0e21\u0e02\u0e2d\u0e07\u0e04\u0e38\u0e13\u0e17\u0e35\u0e48\u0e19\u0e35\u0e48"}}},lng:Ue}),s.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(Le,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[75,1,2]]]);
//# sourceMappingURL=main.2cbca229.chunk.js.map